<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Glucose Monitor Exploration</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #hero {
    height: 80vh; /* Full screen height is 100*/
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #e3f2fd;
    position: relative;
    overflow: hidden;
    }

    #hero-title {
        font-size: 60px;
        font-weight: bold;
        color: #007bff; 
        text-transform: uppercase;
        transition: transform 0.1s ease-out;
    }

    #hero-subtitle {
        font-size: 18px;
        color: #4f5577;
        margin-top: 10px;
        transition: opacity 0.3s ease-out;
    }
    #thin-content {
    max-width: 600px;
    text-align: left;
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 30px;
    }

    #thin-content p {
        font-size: 17px;
        color: #333;
        line-height: 1.8;
        margin-bottom: 15px;
    }

    #thin-content strong {
        font-weight: bold;
        color: #123861; 
    }
    body {
      font-family: sans-serif;
      margin: 0; 
      padding: 0;
    }

    .chart-container {
      display: flex; 
      justify-content: space-around; 
      margin-top: 20px;
    }
    .chart {
      width: 450px; 
      height: 300px;
      position: relative;
    }
    .chart-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .axis path, .axis line {
      stroke: #ccc;
    }
    .horizontal-chart-container {
    display: flex;         
    justify-content: center; 
    gap: 20px;             
    margin-top: 20px;
    }
    .bar {
    opacity: 0;
    transform: translateX(-50px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }


    .in-view .bar {
        opacity: 1;
        transform: translateX(0);
    }
    .chart {
        width: 120px; 
        height: 300px;  
        position: relative;
    }
    #thin-text-2 {
    max-width: 600px; 
    text-align: left;
    background: white; 
    padding: 25px;
    border-radius: 8px;
    margin: 40px auto; 
    }

    #thin-text-2 h3 {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    #thin-text-2 p {
        font-size: 16px;
        color: #3d3d3d;
        line-height: 1.8;
        margin-bottom: 15px;
    }

    #thin-text-2 ul {
        padding-left: 20px;
        margin-bottom: 15px;
    }

    #thin-text-2 li {
        font-size: 16px;
        line-height: 1.6;
    }

    #thin-text-2 strong {
        font-weight: bold;
    }

    #thin-text-2 span {
        font-weight: bold;
    }
    #thin-text-3 {
    max-width: 600px; 
    text-align: left;
    background: white;
    padding: 25px;
    border-radius: 8px;
    margin: 40px auto; 
    }

    #thin-text-3 h3 {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    #thin-text-3 p {
        font-size: 16px;
        color: #333;
        line-height: 1.8;
        margin-bottom: 15px;
    }

    #thin-text-3 strong {
        font-weight: bold;
    }

    #thin-text-3 br {
        margin-bottom: 10px;
    }

    #thin-text-4 {
        max-width: 600px;
        text-align: left;
        background: white;
        padding: 25px;
        border-radius: 8px;
        margin: 40px auto;
    }

    #thin-text-4 h3 {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    #thin-text-4 p {
        font-size: 16px;
        color: #333;
        line-height: 1.8;
        margin-bottom: 15px;
    }
  </style>
</head>
<body>
    <div id="hero">
        <h1 id="hero-title">GLUCOSE LEVEL & MONITORED DATA</h1>
        <p id="hero-subtitle">An interactive analysis of glucose & health data</p>
        <div id="thin-content">
            <p><strong>Wearable devices are transforming healthcare.</strong> With the rise of smartwatches and fitness trackers, health monitoring is more accessible than ever. Some wearables have even been credited with saving lives during medical emergencies.</p>
        
            <p><strong>Diabetes is a growing concern.</strong> As global obesity rates increase, so does the prevalence of diabetes. Research shows a clear correlation between obesity and diabetes, making early detection more critical than ever.</p>
        
            <p><strong>Can wearable devices help track glucose changes?</strong> If continuous glucose monitors and other wearable sensors can detect patterns in blood sugar levels, they could provide early warnings and help prevent dangerous fluctuations.</p>
        
            <p>In this analysis, we explore real-world data from glucose monitoring devices, examining their effectiveness in tracking blood sugar variations across different health conditions.</p>
        </div>
    </div>

    <div id="thin-text-2">
        <h3>Understanding the Data</h3>
        <p>
            In this analysis, we explore how various biometric signalsâ€”such as heart rate, body temperature, and movementâ€”correlate with glucose levels. 
            The goal is to determine whether wearable devices can detect meaningful glucose changes and help in early diabetes management.
        </p>
    
        <p><strong>What Are We Measuring?</strong></p>
        <ul>
            <li><strong>Glucose Value:</strong> Directly measured blood sugar levels.</li>
            <li><strong>Accelerometer (ACC):</strong> Captures movement and activity levels.</li>
            <li><strong>Blood Volume Pulse (BVP):</strong> Tracks changes in blood flow, associated with cardiovascular activity.</li>
            <li><strong>Electrodermal Activity (EDA):</strong> Measures skin conductance, which relates to sweat and nervous system activity.</li>
            <li><strong>Heart Rate (HR):</strong> Monitors beats per minute, potentially affected by glucose fluctuations.</li>
            <li><strong>Interbeat Interval (IBI):</strong> The time between heartbeats, another cardiovascular metric.</li>
            <li><strong>Skin Temperature (TEMP):</strong> Monitors body temperature variations.</li>
        </ul>
    
        <p><strong>What is Correlation?</strong></p>
        <p>
            Correlation measures the relationship between two variables. A positive correlation means that when glucose increases, the measured variable also increases. 
            A negative correlation means that as glucose increases, the measured variable decreases. If correlation is close to zero, there is little to no meaningful relationship.
        </p>
    
        <h3>Methodology</h3>
        <p>
            We analyzed biometric data collected from wearable devices and glucose monitors. Participants were divided into two groups based on their HbA1c levels:
        </p>
        <ul>
            <li><span style="color: #ff6b6b;"><strong>Diabetic Group:</strong></span> Participants with HbA1c > 5.7.</li>
            <li><span style="color: #4a90e2;"><strong>Non-Diabetic Group:</strong></span> Participants with HbA1c â‰¤ 5.7.</li>
        </ul>
    
        <p>
            For each participant, we computed correlation values between glucose levels and wearable measurements.
            The results are categorized into three sections:
        </p>
        <ul>
            <li><strong>Both Groups:</strong> Strong correlations exist in both diabetic and non-diabetic groups.</li>
            <li><strong>One Group:</strong> A correlation exists in only one group.</li>
            <li><strong>Neither:</strong> No significant correlation found.</li>
        </ul>
    
        <p>
            To help visualize the results, we plotted the correlation values across different measurements.
            The shaded gray area in the graphs represents little correlations (-0.1 to 0.1), while EVIDENCED correlations extend beyond this range.
        </p>
    </div> 
    <div id="graph-container">
        <h3 style="text-align:center;">Different monitered data reacts differently in diabetic/nondiabetic population</h3>
            <div class="chart-container">
            <div class="chart">
                <div class="chart-title">Both Groups</div>
                <svg id="chart-both"></svg>
            </div>
            <div class="chart">
                <div class="chart-title">One Group</div>
                <svg id="chart-one"></svg>
            </div>
            <div class="chart">
                <div class="chart-title">Neither</div>
                <svg id="chart-neither"></svg>
            </div>
</div>
    </div>   

<div class="legend">
    <div>
      <span class="legend-box" style="background: pink;"></span>
      <span>Sampled from participants with higher-than-normal HbA1c (>5.7)</span>
    </div>
    <div>
      <span class="legend-box" style="background: lightblue;"></span>
      <span>Sampled from participants with theoretical normal HbA1c</span>
    </div>
</div>
<div class="button-container">
    <!-- Listen I know this looks unnecessary but I built it having the idea there will be button, and when I try to delete the div, it just broke more stuff. So i left it here at 0 pixel. -->
    <button id="replay-animation"></button>
</div>
<div id="thin-text-3">
    <h3>Interpreting the Results</h3>

    <p><strong>At a glance, we see that different biometric signals respond differently to glucose changes.</strong> Some measurements show strong correlations across all participants, while others vary based on diabetes status.</p>

    <h3>Breaking Down the Results</h3>

    <p><strong>Both Groups:</strong> Electrodermal Activity (EDA) and Skin Temperature show correlation with glucose levels in both diabetic and non-diabetic participants.</p>
    <p>ðŸ’¡ This suggests that **stress response and body temperature regulation** might play a role in glucose fluctuations across all individuals.</p>

    <p><strong>One Group:</strong> Heart Rate (HR) and Accelerometer (ACC) correlate with glucose levels in diabetic participants, but not in non-diabetics.</p>
    <p>ðŸ’¡ This could mean that **heart rate fluctuations and movement patterns** are more affected by glucose instability in diabetics.</p>

    <p><strong>Neither:</strong> Interbeat Interval (IBI) and Blood Volume Pulse (BVP) show **weak or no correlation** with glucose levels.</p>
    <p>ðŸ’¡ These signals may not be reliable indicators of glucose change and might require further study to determine their role.</p>

    <p>We later break further down the groups to specific HbA1c levels among our testing data.</p>


    
</div>

<h3>HbA1c Level-impact-correlation breakdown</h3>
<div class="slider-container">
    <label for="hba1c-slider">Select HbA1c Level:</label>
    <input type="range" id="hba1c-slider" min="5.3" max="6.4" step="0.1">
    <span id="hba1c-value">5.3</span>
</div>


<div class="horizontal-chart-container">
    <div class="chart"><div class="chart-title">ACC</div><svg id="chart-ACC"></svg></div>
    <div class="chart"><div class="chart-title">BVP</div><svg id="chart-BVP"></svg></div>
    <div class="chart"><div class="chart-title">EDA</div><svg id="chart-EDA"></svg></div>
    <div class="chart"><div class="chart-title">HR</div><svg id="chart-HR"></svg></div>
    <div class="chart"><div class="chart-title">IBI</div><svg id="chart-IBI"></svg></div>
    <div class="chart"><div class="chart-title">TEMP</div><svg id="chart-TEMP"></svg></div>
</div>
<div id="thin-text-4">
    <h3>Exploring Individual Glucose Correlations</h3>

    <p>
        The slider allows us to explore how different **HbA1c levels** influence glucose correlations across various biometric signals. 
        HbA1c represents long-term blood sugar control, and by adjusting the slider, we can see how different measurementsâ€”such as heart rate, skin temperature, and movementâ€”correlate with glucose levels.
    </p>

    <p>
        Some measurements may be more relevant for people with higher or lower, or a specific range of HbA1c levels.
        This visualization helps identify which wearable signals play a better role in tracking glucose variations for different groups.
    </p>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// DONT DELETE STUFF EVEN IF THEY ARE REPETITIVE. THINGS MAGICALLY BREAK
const labelMapping = {
  "EDA": "Electrodermal Activity",
  "ACC": "Accelerometer",
  "HR": "Heart Rate ",
  "IBI": "Interbeat Interval",
  "TEMP": "Skin Temperature",
  "BVP": "Blood Volume Pulse ",
  "Dexcom": "Glucose"
};


const colorDiabetes = "lightblue";   
const colorNormal = "pink";     

function drawChart(data, svgSelector) {

  const margin = { top: 10, right: 20, bottom: 20, left: 120 },
        width = 450,   
        height = 300; 

  const svg = d3.select(svgSelector)
    .attr("width", width)
    .attr("height", height);


  if (!data || data.length === 0) {
    svg.append("text")
       .attr("x", width/2)
       .attr("y", height/2)
       .attr("text-anchor", "middle")
       .text("No data in this category");
    return;
  }


  data.forEach(d => {
    d.Diabetes = +d.Diabetes;
    d["Non-Diabetes"] = +d["Non-Diabetes"];
  });

  const xScale = d3.scaleLinear()
    .domain([-0.2, 0.2])
    .range([margin.left, width - margin.right]);


  const yScale = d3.scaleBand()
    .domain(data.map(d => d.Measurement))
    .range([margin.top, height - margin.bottom])
    .padding(0.4);
    


  const xAxis = d3.axisBottom(xScale).ticks(5);
  svg.append("g")
    .attr("class", "axis x-axis")
    .attr("transform", `translate(0, ${height - margin.bottom})`)
    .call(xAxis);


  const yAxis = d3.axisLeft(yScale)
  .tickFormat(d => labelMapping[d] || d);

  svg.append("g")
    .attr("class", "axis y-axis")
    .attr("transform", `translate(${margin.left}, 0)`)
    .call(yAxis);


  svg.append("rect")
    .attr("x", xScale(-0.1))
    .attr("y", margin.top)
    .attr("width", xScale(0.1) - xScale(-0.1))
    .attr("height", height - margin.top - margin.bottom)
    .attr("fill", "#f0f0f0");


  svg.append("line")
    .attr("x1", xScale(0))
    .attr("y1", margin.top)
    .attr("x2", xScale(0))
    .attr("y2", height - margin.bottom)
    .attr("stroke", "#999")
    .attr("stroke-dasharray", "2,2");

  svg.selectAll(".row-group")
    .data(data)
    .enter()
    .append("g")
      .attr("class", "row-group")
    .each(function(d, i) {
      const g = d3.select(this);

      const band = yScale.bandwidth();
      const barHeight = band * 0.2;


      g.append("rect")
        .attr("y", yScale(d.Measurement) + band * 0.1)
        .attr("height", barHeight)
        .attr("x", xScale(0)) 
        .attr("width", 0)     
        .attr("fill", "pink")
        .transition()
          .duration(1000)
          .delay(i * 200)
          .attr("x", xScale(Math.min(d.Diabetes, 0)))
          .attr("width", Math.abs(xScale(d.Diabetes) - xScale(0)));

      g.append("rect")
        .attr("y", yScale(d.Measurement) + band * 0.5)
        .attr("height", barHeight)
        .attr("x", xScale(0))
        .attr("width", 0)
        .attr("fill", "lightblue")
        .transition()
          .duration(1000)
          .delay(i * 200)
          .attr("x", xScale(Math.min(d["Non-Diabetes"], 0)))
          .attr("width", Math.abs(xScale(d["Non-Diabetes"]) - xScale(0)));
    });
}



//////////////////////////////////////////////////////////
// Main code: load CSV, split by category, call drawChart
//////////////////////////////////////////////////////////
window.addEventListener("scroll", function() {
            let scrollPos = window.scrollY;
            document.getElementById("hero-title").style.transform = `translateX(${-scrollPos * 1}px)`;
            document.getElementById("hero-subtitle").style.opacity = Math.max(1 - scrollPos / 300, 0);
        });


let bothGroups, oneGroup, neither;
d3.csv("correlations1.csv").then(fullData => {

  fullData.forEach(d => {
    d.Diabetes = +d.Diabetes;
    d["Non-Diabetes"] = +d["Non-Diabetes"];
  });


  bothGroups = fullData.filter(d => d.ImpactCategory === "Both Groups");
  oneGroup = fullData.filter(d => d.ImpactCategory === "One Group");
  neither = fullData.filter(d => d.ImpactCategory === "Neither");

  drawChart(bothGroups, "#chart-both");
  drawChart(oneGroup, "#chart-one");
  drawChart(neither, "#chart-neither");
});

function restartCharts() {

  d3.select("#chart-both").html("");
  d3.select("#chart-one").html("");
  d3.select("#chart-neither").html("");

  drawChart(bothGroups, "#chart-both");
  drawChart(oneGroup, "#chart-one");
  drawChart(neither, "#chart-neither");
}
function isInViewport(element) {
    const rect = element.getBoundingClientRect();
    return rect.top < window.innerHeight * 0.75; 
}


document.addEventListener("scroll", restartCharts);


document.addEventListener("DOMContentLoaded", restartCharts);
document.getElementById("replay-animation").addEventListener("click", restartCharts);
let correlationData = {};


d3.csv("final_correlations.csv").then(data => {
    data.forEach(d => {
        let hba1c = parseFloat(d.HbA1c);
        correlationData[hba1c] = {
            "ACC": +d["ACC Corr"],
            "BVP": +d["BVP Corr"],
            "EDA": +d["EDA Corr"],
            "HR": +d["HR Corr"],
            "IBI": +d["IBI Corr"],
            "TEMP": +d["TEMP Corr"]
        };
    });


    updateCharts(5.3);
});


document.getElementById("hba1c-slider").addEventListener("input", function() {
    let selectedValue = parseFloat(this.value);
    document.getElementById("hba1c-value").innerText = selectedValue;
    updateCharts(selectedValue);
});

function updateCharts(hba1cLevel) {
    let data = correlationData[hba1cLevel] || {
        "ACC": 0, "BVP": 0, "EDA": 0, "HR": 0, "IBI": 0, "TEMP": 0
    };
    

    const width = 100, height = 300, margin = { top: 10, right: 10, bottom: 30, left: 10 };


    const yScale = d3.scaleLinear()
        .domain([-0.3, 0.3])
        .range([height - margin.bottom, margin.top]);

    const xScale = d3.scaleBand()
        .domain(["bar"])
        .range([margin.left, width - margin.right])
        .padding(0.1);

    ["ACC", "BVP", "EDA", "HR", "IBI", "TEMP"].forEach(feature => {
        let svg = d3.select("#chart-" + feature);
        svg.selectAll("*").remove(); 

        svg.attr("width", width).attr("height", height);

        svg.append("rect")
            .attr("x", margin.left)
            .attr("width", width - margin.right - margin.left)
            .attr("y", yScale(0.1))  
            .attr("height", yScale(-0.1) - yScale(0.1)) 
            .attr("fill", "#f0f0f0");
            
        svg.append("line")
            .attr("x1", margin.left)
            .attr("x2", width - margin.right)
            .attr("y1", yScale(0))
            .attr("y2", yScale(0))
            .attr("stroke", "#999")
            .attr("stroke-dasharray", "2,2");


        svg.append("rect")
            .attr("x", xScale("bar"))
            .attr("width", xScale.bandwidth())
            .attr("y", yScale(0))
            .attr("height", 0)
            .attr("fill", data[feature] > 0 ? "pink" : "lightblue")
            .on("mouseover", function (event, d) {
                tooltip.style("visibility", "visible")
                       .html(`${featureNames[feature]}: ${data[feature].toFixed(3)}`);
            })
            .on("mousemove", function (event) {
                tooltip.style("top", (event.pageY - 10) + "px")
                       .style("left", (event.pageX + 10) + "px");
            })
            .on("mouseout", function () {
                tooltip.style("visibility", "hidden");
            })
            .transition()
            .duration(1000)
            .attr("y", yScale(Math.max(data[feature], 0)))
            .attr("height", Math.abs(yScale(data[feature]) - yScale(0)));

        svg.append("g")
            .attr("transform", `translate(${width / 2}, 0)`)
            .call(d3.axisLeft(yScale).ticks(5));

    });
}
</script>
<div id="food-visualization">
  </div>
  <script type="module" src="js/script.js"></script>
  <link rel="stylesheet" href="css/style.css">
</body>
</html>
