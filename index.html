<!DOCTYPE html>
<html lang="en">
<head>
  <!-- META & TITLE -->
  <meta charset="UTF-8">
  <title>Glucose Monitor Exploration</title>

  <!-- EXTERNAL STYLE SHEET -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>
  
  <!-- HERO SECTION: Title, Subtitle & Intro Text -->
  <div id="hero">
    <h1 id="hero-title">GLUCOSE LEVEL & MONITORED DATA</h1>
    <p id="hero-subtitle">An interactive analysis of glucose & health data</p>
    <div id="thin-content">
      <p><strong>Did you know that one in ten Americans suffer from type 2 diabetes? In fact one out of every three American adults have prediabetes, putting them at an inherently higher risk of diabetes. 
      </strong></p>
      <p><strong>Diabetes is a growing concern.</strong> As global obesity rates increase, so does the prevalence of diabetes. Research shows a clear correlation between obesity and diabetes, making early detection more critical than ever.</p>
      <p><strong>Wearable devices are transforming healthcare.</strong> With the rise of smartwatches and fitness trackers, health monitoring is more accessible than ever. Some wearables have even been credited with being able to discover early signs of life changing diseases, which otherwise would have gone unnoticed. 
      </p>
      <p><strong>Can wearable devices help track glucose changes?</strong> If continuous glucose monitors and other wearable sensors can detect patterns in blood sugar levels, they could provide early warnings and help prevent dangerous fluctuations.</p>
      <p><strong>Can glucose device tracking data reveal anything about the diet we consume?</strong>Another key way in which these wearable devices could be impactful is based on their constant tracking of glucose level, which provides continuous data throughout the day and helps users view the fluctuation as the day goes. This data pair along with the food log data could be essentially in discovering possible connections in which the diet we eat has on our glucose levels. 
      </p>
      <p><strong>In this analysis, we explore real-world data from glucose monitoring devices, examining their effectiveness in tracking blood sugar variations across different health conditions.</strong></p>
    </div>
  </div>

  <!-- DATA EXPLANATION & METHODOLOGY -->
  
  <div id="thin-text-2">
    <h3>Understanding the Data</h3>
      <p>
        In this analysis, we explore how various biometric signalsâ€”such as heart rate, body temperature, and movementâ€”correlate with glucose levels. 
        The goal is to determine whether wearable devices can detect meaningful glucose changes and help in early diabetes management.
      </p>
      <p><strong>What Are We Measuring?</strong></p>
      <ul>
        <li><strong>Glucose Value:</strong> Directly measured blood sugar levels.</li>
        <li><strong>Accelerometer (ACC):</strong> Captures movement and activity levels.</li>
        <li><strong>Blood Volume Pulse (BVP):</strong> Tracks changes in blood flow, associated with cardiovascular activity.</li>
        <li><strong>Electrodermal Activity (EDA):</strong> Measures skin conductance, which relates to sweat and nervous system activity.</li>
        <li><strong>Heart Rate (HR):</strong> Monitors beats per minute, potentially affected by glucose fluctuations.</li>
        <li><strong>Interbeat Interval (IBI):</strong> The time between heartbeats, another cardiovascular metric.</li>
        <li><strong>Skin Temperature (TEMP):</strong> Monitors body temperature variations.</li>
      </ul>
      <p><strong>What is Correlation?</strong></p>
      <p>
        Correlation measures the relationship between two variables. A positive correlation means that when glucose increases, the measured variable also increases. 
        A negative correlation means that as glucose increases, the measured variable decreases. If correlation is close to zero, there is little to no meaningful relationship.
      </p>
      <h3>Methodology</h3>
      <p>
        We analyzed biometric data collected from wearable devices and glucose monitors. Participants were divided into two groups based on their HbA1c levels:
      </p>
      <ul>
        <li><span style="color: #ff6b6b;"><strong>Diabetic Group:</strong></span> Participants with HbA1c > 5.7.</li>
        <li><span style="color: #4a90e2;"><strong>Non-Diabetic Group:</strong></span> Participants with HbA1c â‰¤ 5.7.</li>
      </ul>
      <p>
        For each participant, we computed correlation values between glucose levels and wearable measurements.
        The results are categorized into three sections:
      </p>
      <ul>
        <li><strong>Both Groups:</strong> Strong correlations exist in both diabetic and non-diabetic groups.</li>
        <li><strong>One Group:</strong> A correlation exists in only one group.</li>
        <li><strong>Neither:</strong> No significant correlation found.</li>
      </ul>
      <p>
        To help visualize the results, we plotted the correlation values across different measurements.
        The shaded gray area in the graphs represents little correlations (-0.1 to 0.1), while EVIDENCED correlations extend beyond this range.
      </p>
    </div>
  </div>

  <!-- CORRELATION CHARTS -->
  <div id="graph-container">
    <h3 style="text-align:center;">Different monitered data reacts differently in diabetic/nondiabetic population</h3>
    <div class="chart-container">
      <div class="chart">
        <div class="chart-title">Both Groups</div>
        <svg id="chart-both"></svg>
      </div>
      <div class="chart">
        <div class="chart-title">One Group</div>
        <svg id="chart-one"></svg>
      </div>
      <div class="chart">
        <div class="chart-title">Neither</div>
        <svg id="chart-neither"></svg>
      </div>
    </div>
  </div>

  <!-- LEGEND & (HIDDEN) BUTTON -->
  <div class="legend" style="margin-top: 50px">
    <div style="margin-bottom: 10px;">
      <span class="legend-box" style="background: pink;"></span>
      <span>Sampled from <span style="color: #ff6b6b;">Diabetic Group</span></span>
    </div>
    <div style="margin-right: 30px;"></div>
      <span class="legend-box" style="background: lightblue;"></span>
      <span>Sampled from <span style="color: #4a90e2;">Non-Diabetic Group</span></span>
    </div>
  </div>
  <div class="button-container">
    <!-- This remains as-is (even if it looks unnecessary) -->
    <button id="replay-animation"></button>
  </div>

  <!-- RESULTS INTERPRETATION -->
  <div id="thin-text-3" >
    <h3>Interpreting the Results</h3>
      <p><strong>At a glance, we see that different biometric signals respond differently to glucose changes.</strong> Some measurements show strong correlations across all participants, while others vary based on diabetes status.</p>
      
      <h3>Breaking Down the Results</h3>
      <p><strong>Both Groups:</strong> Electrodermal Activity (EDA) and Skin Temperature show correlation with glucose levels in both diabetic and non-diabetic participants.</p>
      <p>ðŸ’¡ This suggests that <strong> might play a role in glucose fluctuations</strong> across all individuals.</p>
      
      <p><strong>One Group:</strong> Heart Rate (HR) and Accelerometer (ACC) correlate with glucose levels in diabetic participants, but not in non-diabetics.</p>
      <p>ðŸ’¡ This could mean that <strong>heart rate fluctuations and movement patterns</strong> are more affected by glucose instability in diabetics.</p>
      
      <p><strong>Neither:</strong> Interbeat Interval (IBI) and Blood Volume Pulse (BVP) show <strong>weak or no correlation</strong> with glucose levels.</p>
      <p>ðŸ’¡ These signals may not be reliable indicators of glucose change and might require further study to determine their role.</p>
      
      <p>We later break further down the groups to specific HbA1c levels among our testing data.</p>

      <h3>HbA1c Level-impact-correlation breakdown</h3>
      </div>
  </div>

  <!-- HBA1C LEVEL-IMPACT SLIDER & CHARTS -->
  <div class="slider-container">
    <label for="hba1c-slider">Select HbA1c Level:</label>
    <input type="range" id="hba1c-slider" min="5.3" max="6.4" step="0.1">
    <span id="hba1c-value">5.3</span>
  </div>

  <div class="horizontal-chart-container">
    <div class="chart"><div class="chart-title">ACC</div><svg id="chart-ACC"></svg></div>
    <div class="chart"><div class="chart-title">BVP</div><svg id="chart-BVP"></svg></div>
    <div class="chart"><div class="chart-title">EDA</div><svg id="chart-EDA"></svg></div>
    <div class="chart"><div class="chart-title">HR</div><svg id="chart-HR"></svg></div>
    <div class="chart"><div class="chart-title">IBI</div><svg id="chart-IBI"></svg></div>
    <div class="chart"><div class="chart-title">TEMP</div><svg id="chart-TEMP"></svg></div>
  </div>

  <div id="thin-text-4">
    <h3>Exploring Individual Glucose Correlations</h3>
    <p>
      The slider allows us to explore how different <strong>HbA1c levels</strong> influence glucose correlations across various biometric signals. 
      HbA1c represents long-term blood sugar control, and by adjusting the slider, we can see how different measurementsâ€”such as heart rate, skin temperature, and movementâ€”correlate with glucose levels.
    </p>
    <p>
      Some measurements may be more relevant for people with higher or lower, or a specific range of HbA1c levels.
      This visualization helps identify which wearable signals play a better role in tracking glucose variations for different groups.
    </p>
  </div>

  <!-- D3 SCRIPT (CORRELATIONS & SLIDER) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  // DO NOT DELETE ANYTHING EVEN IF IT SEEMS REPETITIVE. REMOVING IT MAY UNEXPECTEDLY CAUSE ISSUES.
  const labelMapping = {
    "EDA": "Electrodermal Activity",
    "ACC": "Accelerometer",
    "HR": "Heart Rate ",
    "IBI": "Interbeat Interval",
    "TEMP": "Skin Temperature",
    "BVP": "Blood Volume Pulse ",
    "Dexcom": "Glucose"
  };

  const colorDiabetes = "lightblue";   
  const colorNormal = "pink";     

  function drawChart(data, svgSelector) {
    const margin = { top: 10, right: 20, bottom: 20, left: 120 },
          width = 450,
          height = 300; 

    const svg = d3.select(svgSelector)
      .attr("width", width)
      .attr("height", height);

    if (!data || data.length === 0) {
      svg.append("text")
         .attr("x", width/2)
         .attr("y", height/2)
         .attr("text-anchor", "middle")
         .text("No data in this category");
      return;
    }

    data.forEach(d => {
      d.Diabetes = +d.Diabetes;
      d["Non-Diabetes"] = +d["Non-Diabetes"];
    });

    const xScale = d3.scaleLinear()
      .domain([-0.15, 0.15  ])
      .range([margin.left, width - margin.right]);

    const yScale = d3.scaleBand()
      .domain(data.map(d => d.Measurement))
      .range([margin.top, height - margin.bottom])
      .padding(0.4);

    const xAxis = d3.axisBottom(xScale).ticks(5);
    svg.append("g")
      .attr("class", "axis x-axis")
      .attr("transform", `translate(0, ${height - margin.bottom})`)
      .call(xAxis);

    const yAxis = d3.axisLeft(yScale)
      .tickFormat(d => labelMapping[d] || d);

    svg.append("g")
      .attr("class", "axis y-axis")
      .attr("transform", `translate(${margin.left}, 0)`)
      .call(yAxis);

    // Shaded gray area for -0.1 to 0.1
    svg.append("rect")
      .attr("x", xScale(-0.1))
      .attr("y", margin.top)
      .attr("width", xScale(0.1) - xScale(-0.1))
      .attr("height", height - margin.top - margin.bottom)
      .attr("fill", "#f0f0f0");

    // Vertical line at x=0
    svg.append("line")
      .attr("x1", xScale(0))
      .attr("y1", margin.top)
      .attr("x2", xScale(0))
      .attr("y2", height - margin.bottom)
      .attr("stroke", "#999")
      .attr("stroke-dasharray", "2,2");

    // Bars
    svg.selectAll(".row-group")
      .data(data)
      .enter()
      .append("g")
        .attr("class", "row-group")
      .each(function(d, i) {
        const g = d3.select(this);
        const band = yScale.bandwidth();
        const barHeight = band * 0.2;

        // Diabetes bar
        g.append("rect")
          .attr("y", yScale(d.Measurement) + band * 0.1)
          .attr("height", barHeight)
          .attr("x", xScale(0))
          .attr("width", 0)
          .attr("fill", "pink")
          .transition()
            .duration(1000)
            .delay(i * 200)
            .attr("x", xScale(Math.min(d.Diabetes, 0)))
            .attr("width", Math.abs(xScale(d.Diabetes) - xScale(0)));

        // Non-Diabetes bar
        g.append("rect")
          .attr("y", yScale(d.Measurement) + band * 0.5)
          .attr("height", barHeight)
          .attr("x", xScale(0))
          .attr("width", 0)
          .attr("fill", "lightblue")
          .transition()
            .duration(1000)
            .delay(i * 200)
            .attr("x", xScale(Math.min(d["Non-Diabetes"], 0)))
            .attr("width", Math.abs(xScale(d["Non-Diabetes"]) - xScale(0)));
      });
  }

  //////////////////////////////////////////////////////////
  // Main code: load CSV, split by category, call drawChart
  //////////////////////////////////////////////////////////
  window.addEventListener("scroll", function() {
    let scrollPos = window.scrollY;
    document.getElementById("hero-title").style.transform = `translateX(${-scrollPos * 1}px)`;
    document.getElementById("hero-subtitle").style.opacity = Math.max(1 - scrollPos / 300, 0);
  });

  let bothGroups, oneGroup, neither;
  d3.csv("correlations1.csv").then(fullData => {
    fullData.forEach(d => {
      d.Diabetes = +d.Diabetes;
      d["Non-Diabetes"] = +d["Non-Diabetes"];
    });

    bothGroups = fullData.filter(d => d.ImpactCategory === "Both Groups");
    oneGroup = fullData.filter(d => d.ImpactCategory === "One Group");
    neither   = fullData.filter(d => d.ImpactCategory === "Neither");

    drawChart(bothGroups, "#chart-both");
    drawChart(oneGroup, "#chart-one");
    drawChart(neither, "#chart-neither");
  });

  function restartCharts() {
    d3.select("#chart-both").html("");
    d3.select("#chart-one").html("");
    d3.select("#chart-neither").html("");

    drawChart(bothGroups, "#chart-both");
    drawChart(oneGroup, "#chart-one");
    drawChart(neither, "#chart-neither");
  }

  function isInViewport(element) {
    const rect = element.getBoundingClientRect();
    return rect.top < window.innerHeight * 0.75; 
  }

  document.addEventListener("scroll", restartCharts);
  document.addEventListener("DOMContentLoaded", restartCharts);
  document.getElementById("replay-animation").addEventListener("click", restartCharts);

  let correlationData = {};
  d3.csv("final_correlations.csv").then(data => {
      data.forEach(d => {
          let hba1c = parseFloat(d.HbA1c);
          correlationData[hba1c] = {
              "ACC": +d["ACC Corr"],
              "BVP": +d["BVP Corr"],
              "EDA": +d["EDA Corr"],
              "HR": +d["HR Corr"],
              "IBI": +d["IBI Corr"],
              "TEMP": +d["TEMP Corr"]
          };
      });
      updateCharts(5.3);
  });

  document.getElementById("hba1c-slider").addEventListener("input", function() {
    let selectedValue = parseFloat(this.value).toFixed(1);
    
    if (!dataExists(selectedValue)) {
        let nextValidValue = findNextValidHba1c(selectedValue);
        if (nextValidValue !== null) {
            this.value = nextValidValue; 
            selectedValue = nextValidValue;
        } else {
            console.warn("No valid HbA1c data points available.");
            return;
        }
    }

    document.getElementById("hba1c-value").innerText = selectedValue;
    updateCharts(selectedValue);
});

  function dataExists(hba1cValue) {
      return correlationData[hba1cValue] !== undefined;
  }

  function findNextValidHba1c(currentValue) {
      let min = parseFloat(document.getElementById("hba1c-slider").min);
      let max = parseFloat(document.getElementById("hba1c-slider").max);
      let step = parseFloat(document.getElementById("hba1c-slider").step);
      
      let nextValue = parseFloat(currentValue);
      
      while (nextValue <= max) {
          nextValue = (nextValue + step).toFixed(1);
          if (dataExists(nextValue)) return nextValue;
      }

      nextValue = parseFloat(currentValue);
      while (nextValue >= min) {
          nextValue = (nextValue - step).toFixed(1);
          if (dataExists(nextValue)) return nextValue;
      }

      return null; 
  }


  function updateCharts(hba1cLevel) {
      let data = correlationData[hba1cLevel] || {
          "ACC": 0, "BVP": 0, "EDA": 0, "HR": 0, "IBI": 0, "TEMP": 0
      };

      const width = 100, height = 300, margin = { top: 10, right: 10, bottom: 30, left: 10 };
      const yScale = d3.scaleLinear()
          .domain([-0.3, 0.3])
          .range([height - margin.bottom, margin.top]);

      const xScale = d3.scaleBand()
          .domain(["bar"])
          .range([margin.left, width - margin.right])
          .padding(0.1);

      ["ACC", "BVP", "EDA", "HR", "IBI", "TEMP"].forEach(feature => {
          let svg = d3.select("#chart-" + feature);
          svg.selectAll("*").remove(); 
          svg.attr("width", width).attr("height", height);

          // Gray area for -0.1 to 0.1
          svg.append("rect")
              .attr("x", margin.left)
              .attr("width", width - margin.right - margin.left)
              .attr("y", yScale(0.1))
              .attr("height", yScale(-0.1) - yScale(0.1))
              .attr("fill", "#f0f0f0");

          // Horizontal line at y=0
          svg.append("line")
              .attr("x1", margin.left)
              .attr("x2", width - margin.right)
              .attr("y1", yScale(0))
              .attr("y2", yScale(0))
              .attr("stroke", "#999")
              .attr("stroke-dasharray", "2,2");

          // Bar
          svg.append("rect")
              .attr("x", xScale("bar"))
              .attr("width", xScale.bandwidth())
              .attr("y", yScale(0))
              .attr("height", 0)
              .attr("fill", data[feature] > 0 ? "pink" : "lightblue")
              .on("mouseover", function (event, d) {
                  tooltip.style("visibility", "visible")
                         .html(`${featureNames[feature]}: ${data[feature].toFixed(3)}`);
              })
              .on("mousemove", function (event) {
                  tooltip.style("top", (event.pageY - 10) + "px")
                         .style("left", (event.pageX + 10) + "px");
              })
              .on("mouseout", function () {
                  tooltip.style("visibility", "hidden");
              })
              .transition()
              .duration(1000)
              .attr("y", yScale(Math.max(data[feature], 0)))
              .attr("height", Math.abs(yScale(data[feature]) - yScale(0)));

          // Y-axis
          svg.append("g")
              .attr("transform", `translate(${width / 2}, 0)`)
              .call(d3.axisLeft(yScale).ticks(5));
      });
  }
  </script>

  <!-- SECTION: DIET & MEAL VISUALIZATION -->
  <header class="thin-text">
    <h1>Now How Does Glucose Tracking Relate With Our Diets?</h1>
    <p>
      Now that we have covered how biometrics could help track pre diabetes, let's explore how diets played a role in this study. 
      We all know diabetes is often the result of poor eating habits and we aim to explore how exactly consuming food throughout the day would impact our glucose tracking levels.
      But is it possible to use the glucose data collected from wearable devices in order to find trends and possibly make a valid conclusion on the impact diet has on our glucose levels?
    </p>
  </header>



  <header class="thin-text">
    <h3>Understanding the Data</h3>
        <p>
          In this analysis, we explore how glucose fluctuates over time and how it reacts to when someone is eating. We hope to determine which qualities of food have a significant impact on the glucose levels of people in order to help viewers get a broader understanding of the impact of the food they consume. 
        </p>
        
        <h3>Methodology</h3>
        <p>
          We analyzed the glucose levels within the full 10 days in which the experiment took place. Our visualization contained three participants in order to avoid data clustering, in which the three participants were selected by participants with the least amount of missing data. All three participants had consistent glucose and food meal data for all ten days which is why we  decided to use them for our visuals. Furthermore, we included a filter in the legend, in which specific participants could be selected to be displayed. This along with the zoom feature negates the potential issues of data clustering within the visual. 

        </p>
        <p>
          Additionally every meal that the participants ate in those 10 days were also included at the time in which it was eaten. Upon clicking each meal, it displays essential information about that meal through the use of a toolkit. We decided to create filters based on some assumptions. 
        </p>
        <p><strong>Assumptions:</strong></p>
        <ul>
          <li><strong>Sugary Meals Lead to Higher Spikes in Glucose Levels (50g>)
          </strong></li> 
          <li><strong>Higher Calorie Meals Results to Higher Spikes in Glucose Levels(300>)
          </strong> </li>
          <li><strong>Carb Heavy Meals Causes Higher Spikes in Glucose Levels (50>)
          </strong> </li>
        </ul>
        <p> 
          Finally to add more visual appeal and for users to better visualize the change in glucose levels after a meal, we added an animation feature in which traces the first three hours of the glucose levels after a meal was eaten. 
        </p>
  </header>


    <title>Glucose & Meal Visualization</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="module" src="js/script.js" defer></script>
  
  
    <div id="controls">
      <h2>Filters</h2>
      <div id="participant-filters">
        <label><input type="checkbox" class="participant-checkbox" value="001" checked> Participant 1</label>
        <label><input type="checkbox" class="participant-checkbox" value="006" checked> Participant 2</label>
        <label><input type="checkbox" class="participant-checkbox" value="011" checked> Participant 3</label>
      </div>
      <div id="meal-filters">
        <label><input type="checkbox" id="high-sugar" /> High Sugar Meals (sugar > 50)</label>
        <label><input type="checkbox" id="high-calorie" /> High Calorie Meals (calories > 300)</label>
        <label><input type="checkbox" id="high-carb" /> High Carb Meals (carbs > 50)</label>
      </div>
      <button id="resetZoom">Reset Zoom</button>
    </div>
  
    <div id="food-visualization"></div>
  
    <div id="tooltip" class="tooltip"></div>
  <script type="module" src="js/script.js"></script>
  <link rel="stylesheet" href="css/style.css">

  <header class="thin-text">
    <h3>Breaking Down the Results</h3>
    <ul>
      <li>
        In general it does seem that fewer calories, meals with low sugar and carbs tend to have less of a significant effect on the glucose levels compared to meals with these qualities which often lead to heavy fluctuations, especially if it meets all three criterias.
      </li>
      <li>
        Carbohydrates levels seemed to be the most impactful determinants of glucose levels, even more so than sugar. Some of the most drastic peaks occurred after meals with lower amounts of sugar but a high amount of carbohydrates. 
      </li>
      <li>
        One Shocking finding is that the time of day seems to play a heavy role on the glucose levels, sometimes being more impactful than the meal being eaten. It seems like for most participants on most days, their glucose levels seem to peak during noon, regardless of whether they have eaten lunch or not.  
      </li>
    </ul>
  </header>
  <header class="thin-text">
    <h1>Final Takeaway</h1>
    <p>
      One surprising takeaway is that your skinâ€™s sweat activity and temperature closely match changes in blood sugar for both people with and without diabetes. Many would assume that your heart rate or other heart signals are the main warning signs, but this visualization shows otherwise by separating the data into two groups and clearly marking which measures are most related to glucose changes. Because it highlights these patterns side by side with easy-to-read labels and color coding, it becomes obvious how these two signals remain consistently tied to blood sugar across different health conditions. This clear setup makes the visualization both simple to spot and difficult to ignore.
    </p>
    <p>
      However, since there is no universal scale that defines how specific health metrics correspond to glucose levels for everyone- For populations with different Hb1Ac levels, a spike in Heart Rate can correlate with different fluctuations in blood sugar levels. Therefore, while wearable devices offer a promising way to support blood sugar monitoring, they should not be used as a standalone tool for managing conditions like diabetes. Instead, they serve as a complementary resource, helping users identify trends and patterns in their own health data.
    </p>
    <p>
      But the data collected from the wearable devices, more specifically the glucose data, when combined with food log data offered some insightful results. The one thing everyone should learn from this project is that our daily dietary choices, - especially high carbohydrate intake and the timing of meals- play an important role in triggering certain fluctuations in our glucose levels. Our visualization successfully displays this by combining the data of a detailed meal log with the continuous data of glucose levels, and utilizing interactive filters and animations to show the impact of certain meals on the levels. Offering compelling insight which could be useful for individuals when making the correct dietary choices that prioritize their health. 
    </p>
  </header>

</body>
</html>